{% extends 'bodega/base.html' %}

{% block title %}Inventario y Stock{% endblock %}

{% block content %}
    <h1><i class="bi bi-box-seam-fill"></i> Inventario y Stock</h1>
    
    <div class="mb-3">
        <a href="{% url 'agregar_producto' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle-fill me-2"></i>Agregar Nuevo Producto
        </a>
        <a href="{% url 'exportar_stock_excel' %}" class="btn btn-info">
            <i class="bi bi-file-earmark-spreadsheet-fill me-2"></i>Exportar a Excel
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Buscar por nombre o código..." name="q" value="{{ query|default:'' }}">
                <button class="btn btn-outline-success" type="submit"><i class="bi bi-search"></i> Buscar</button>
                {% if query %}
                    <a href="{% url 'lista_stock' %}" class="btn btn-outline-secondary ms-2"><i class="bi bi-x-lg"></i> Limpiar</a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <table class="table table-striped table-hover align-middle table-sm">
        <thead class="table-light">
            <tr>
                <th>Código</th>
                <th>Nombre</th>
                <th>Stock</th>
                <th>Ubicación</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in page_obj %}
            
            <tr class="{% if producto.stock_minimo > 0 and producto.cantidad_stock <= producto.stock_minimo %}table-danger{% endif %}">
                <td>{{ producto.codigo_producto }}</td>
                <td>{{ producto.nombre }}</td>
                <td>
                    {{ producto.cantidad_stock }}
                    {% if producto.stock_minimo > 0 and producto.cantidad_stock <= producto.stock_minimo %}
                        <i class="bi bi-exclamation-triangle-fill text-danger ms-2" title="¡Stock bajo!"></i>
                    {% endif %}
                </td>
                <td>{{ producto.ubicacion_rack.codigo_rack|default:"--" }}</td>
                <td class="text-center">
                    <a href="{% url 'editar_producto' pk=producto.codigo_producto %}" class="btn btn-sm btn-warning" title="Editar"><i class="bi bi-pencil-fill"></i></a>
                    <a href="{% url 'historial_producto' pk=producto.codigo_producto %}" class="btn btn-sm btn-success" title="Historial"><i class="bi bi-clock-history"></i></a>
                    <a href="{% url 'generar_qr_producto' pk=producto.codigo_producto %}" class="btn btn-sm btn-secondary" title="Generar QR"><i class="bi bi-qr-code"></i></a>
                    <a href="{% url 'eliminar_producto' pk=producto.codigo_producto %}" class="btn btn-sm btn-danger" title="Eliminar"><i class="bi bi-trash3-fill"></i></a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center">No se encontraron productos.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if page_obj.has_other_pages %}
        {% include 'bodega/partials/paginacion.html' %}
    {% endif %}
{% endblock %}